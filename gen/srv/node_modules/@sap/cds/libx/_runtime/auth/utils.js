const cds = require('../cds')

const UNAUTHORIZED = { statusCode: 401, code: '401', message: 'Unauthorized' }
const FORBIDDEN = { statusCode: 403, code: '403', message: 'Forbidden' }

const getRequiresAsArray = definition => {
  const requires = []

  if (definition['@requires']) {
    if (Array.isArray(definition['@requires'])) requires.push(...definition['@requires'])
    else requires.push(definition['@requires'])
  }

  const { restrict_all_services: restrictAllServices } = cds.env.requires.auth || {}
  if (!requires.length && definition.kind === 'service' && restrictAllServices) requires.push('authenticated-user')

  return requires
}

module.exports = {
  UNAUTHORIZED,
  FORBIDDEN,
  getRequiresAsArray
}
